node {
    stage('Clone') {
        git branch: 'main', url: 'https://github.com/kishoreav14/sample-node-app.git'
    }
    stage('Build Maven') {
        sh 'mvn -B clean install'
    }
    stage('Docker Build & Push') {
        sh 'docker build -t kishoreav/java-app .'
        sh 'echo Kish_ore_123#! | docker login -u kishoreav --password-stdin'
        sh 'docker push kishoreav/java-app'
    }
}
node("k8s"){
stage("deployment"){
sh "export KUBECONFIG=/etc/kubernetes/admin.conf"
sh "sudo kubectl rollout restart deployment/java-app"
}
}
